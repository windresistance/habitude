$(function(){function a(a){return'<span class="name">'+a.name+'</span><a href="#" data-task-del="'+a._id+'">X</a>'}function b(b){var c,d,e=[];for(var f in b)d=b[f],c=a(d),e.push('<li id="'+d._id+'">'+c+"</li>");$(".task-list").prepend(e)}$.get("/tasks",b),$("form").on("submit",function(a){a.preventDefault();var c=$(this),d=c.serialize();$.ajax({type:"POST",url:"/tasks",data:d}).done(function(a){b([a]),c.trigger("reset")})}),$(".task-list").on("click","a[data-task-del]",function(a){var b=$(this);$.ajax({type:"DELETE",url:"/tasks/"+b.data("task-del")}).done(function(){b.parents("li").remove()})}),$(".task-list").on("dblclick","li",function(){var a=$(this),b=a.attr("id"),c=a.children(".name").text();content='<input name="name" value="'+c+'" old="'+c+'" data-task-name="'+b+'"><a href="#" data-task-save="'+b+'">save</a>|<a href="#" data-task-cancel="'+b+'">cancel</a><a href="#" data-task-del="'+b+'">X</a>',a.html(content),$('input[value="'+c+'"]').focus()}),$(".task-list").on("click","a[data-task-save]",function(b){var c=$(this),d=c.siblings("input").val();$.ajax({type:"PUT",url:"/tasks/"+c.data("task-save"),data:{name:d}}).done(function(b){var d=a({_id:c.data("task-save"),name:c.siblings("input").val()});c.parent().html(d)})}),$(".task-list").on("click","a[data-task-cancel]",function(b){var c=$(this),d=a({_id:c.data("task-cancel"),name:c.siblings("input").attr("old")});c.parent().html(d)}),$("ul").sortable({connectWith:"ul",stop:function(a,b){var c;$(this).children().each(function(a){c=$(this).children(a).context.id,$.ajax({type:"PUT",url:"/tasks/"+c,data:{index:a}}).done(function(a){})})}}),$("ul").disableSelection()});